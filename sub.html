<!doctype html>
<html lang="ko">
<head>
    <script>
        if (navigator.userAgent.indexOf('KAKAO') >= 0) alert("해당 브라우저는 서비스를 지원하지 않습니다. 기본 브라우저를 이용해주세요.");
        if (navigator.userAgent.indexOf('[FB') >= 0) alert("해당 브라우저는 서비스를 지원하지 않습니다. 기본 브라우저를 이용해주세요.");
        if (navigator.userAgent.indexOf('Instagram') >= 0) alert("해당 브라우저는 서비스를 지원하지 않습니다. 기본 브라우저를 이용해주세요.");
        if (navigator.userAgent.indexOf('trill') >= 0) alert("해당 브라우저는 서비스를 지원하지 않습니다. 기본 브라우저를 이용해주세요.");
        if (navigator.userAgent.indexOf('NAVER') >= 0) alert("해당 브라우저는 서비스를 지원하지 않습니다. 기본 브라우저를 이용해주세요.");
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WWH9DNGHLQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-WWH9DNGHLQ');
    </script>

    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,minimum-scale=0,maximum-scale=10,user-scalable=yes">
    <meta name="HandheldFriendly" content="true">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="imagetoolbar" content="no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <title>tab select</title>
    <!-- 공통 Css //-->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Roboto&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <!-- 공통 Css //-->
    <script src="./js/jquery-1.10.2.js"></script>
	<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"></script>

<style>
    .progress-bar {
      display: block;
      width: 33%;
      height: 10%;
      max-height: 2%;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate3d(-50%, -50%, 0);
      border-radius: 25px;
      box-shadow: 0px 3px 10px 3px rgba(0, 0, 0, 0.5), 0px 0px 5px 1px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.9);
      background-color: rgba(0, 0, 0, 0.5);
    }
 
    .progress-bar.hide {
      visibility: hidden;
      transition: visibility 0.3s;
    }
 
    .update-bar {
      background-color: rgba(255, 255, 255, 0.9);
      width: 0%;
      height: 100%;
      border-radius: 25px;
      float: left;
      transition: width 0.3s;
    }

    .progress-bar.hide {
      visibility: hidden;
      transition: visibility 0.3s;
    }

</style>
</head>

<body>
	<section class="content">
		<article class="container">
			<div class="cont_wrp">
				<div class="img_cont">
					<div class="img_box" style="background: #fff; height: 600px;">
						<!-- 이미지 넣을 곳
						<span class="img_btn">ar 버튼 위치</span> -->
						<model-viewer id="duck" camera-controls touch-action="none" width="100%" height="100%" 
							alt="A 3D model of a duck" ar-scale="fixed" xr - environment ios-src="">
							<!-- AR 버튼 커스텀-->
							<button id="customAr" slot="ar-button" style="background-color: white; border-radius: 4px; border: none; position: absolute; bottom: 7%; right: 4%;">
								👋 Activate AR
							</button>
							<!-- 프로그레스바 커스텀-->
							<div class="progress-bar hide" slot="progress-bar">
								<div class="update-bar"></div>
							</div>
						
						</model-viewer>
					</div>
					<div class="option_start">
						<h2 class="option_start_title">옵션을 먼저 선택해주세요</h2>
					</div>
				</div>
				<div class="tab_cont">
					<div class="title">
						<h3 class="product_brand">Pebble</h3>
						<h2 class="product_name">Sofa - fabric</h2>
						<h4 class="product_price">1,221,000원 ~</h4>
					</div>
					<div class="select_txt">
						<h2 class="select_title">옵션선택<span class="select_title_span">(*옵션을 선택하시면 최종금액을 확인하실 수 있습니다.)</span></h2>
					</div>
					<div class="option_wrp size_option">
						<div class="option_div">
							<span class="option_title">사이즈</span>
							<a href="javascript:void(0);" class="option_detail popup_size">상세 사이즈 보기</a><!-- 레이어팝업 클래스명 popup_size -->
						</div>
						<ul class="option_ul sizeopt">
							<li class="">
								<a href="javascript:void(0);">1000</a>
							</li>
							<li>
								<a href="javascript:void(0);">1500</a>
							</li>
							<li>
								<a href="javascript:void(0);">1900</a>
							</li>
						</ul>
					</div>
					<div class="option_wrp color_option">
						<div class="option_div">
							<span class="option_title">컬러</span>
							<a href="javascript:void(0);" class="option_detail popup_color">상세 컬러 보기</a><!-- 레이어팝업 클래스명 popup_color -->
						</div>
						<ul class="option_ul coloropt">
							<li class=""> <!-- active 있을때 탭버튼 배경색 달라짐 -->
								<a href="javascript:void(0);">blue</a>
							</li>
							<li>
								<a href="javascript:void(0);">grey</a>
							</li>
							<li>
								<a href="javascript:void(0);">brown</a>
							</li>
						</ul>
					</div>
					
					<div class="addBtn_div">
						<button type="button" class="addBtn" id="addBtn">
							<span class="addBtn_txt"><b>선택상품담기</b>* 구매를 원하시면 선택하세요</span>
						</button>
					</div>
					<div class="option_area">
						<!-- <div class="option_result">
							<div class="result_text">
								<p id="prdName">러그 1000/blue</p>
								<ul class="result_num">
									<li class="num_min">
										<a href="javascript:void(0);"><span class="xi-minus"></span></a>
									</li>
									<li class="num_tit">
										<span>1</span>
									</li>
									<li class="num_plu">
										<a href="javascript:void(0);"><span class="xi-plus"></span></a>
									</li>
								</ul>
							</div>
							<button type="button" class="close_btn"><span class="xi-close"></span></button>
						</div> -->
					</div>
					<div class="option_total">
						<span class="total_tit">총 상품금액(수량)</span>
						<p class="total_price">
							<span class="total_ogPrice show">10000원</span> <!-- show 있을때 오리지널 가격 표시되게 만듬 -->
							<span class="total_rePrice">0원</span>
							<span class="total_num">(0개)</span>
						</p>
						<ul class="purchase_box">
							<li>
								<a href="javascript:void(0);" class="basket">장바구니</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="purchase">구매하기</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</article>
	</section>


	<div class="qr_div" style="display:none;">
		<div class="container">
			<div class="qr_img_wrp">
				<div class="qr_img">
					QR 이미지 넣을곳
				</div>
				<button type="button" class="qr_close_btn"><span class="xi-close"></span></button>
			</div>
		</div>
	</div>

	<div class="size_div" style="display:none;">
		<div class="container">
			상세 사이즈 레이어팝업입니다.
			<button type="button" class="qr_close_btn"><span class="xi-close"></span></button>
		</div>
	</div>

	<div class="color_div" style="display:none;">
		<div class="container">
			상세 컬러 레이어팝업입니다.
			<button type="button" class="qr_close_btn"><span class="xi-close"></span></button>
		</div>
	</div>

	<script>
		var price = 1000;
		var totalprice = 0;
		var pricecnt = 0;
		$(document).ready(function() {
			$(".qr_div").hide();
			$(".img_btn").click(function(){
				$(".qr_div").show();
			});
			$(".qr_close_btn").click(function(){
				$(".qr_div").hide();
			});

			$(".option_ul li").on('click', function() {
				$(this).parent('ul').find('li').removeClass('active');
				$(this).addClass('active');
				var size = $('.sizeopt').find('.active').children('a').text();
				var color = $('.coloropt').find('.active').children('a').text();

				if(size!='' && color!='') {
					$("#duck").show();
					$("#duck").attr("src", "https://hellovr.s3.ap-northeast-2.amazonaws.com/Rugs_Minimal/Circle_"+color+"_"+size+".gltf");
					$("#duck").attr("iosSrc", "https://hellovr.s3.ap-northeast-2.amazonaws.com/Rugs_Minimal/Circle_"+color+"_"+size+".usdz");
					$(".option_start").hide();
					document.querySelector('#duck').addEventListener('progress', onProgress);

				}
			});


			// 추가버튼 클릭
			$("#addBtn").on('click', function() {
				var size = $('.sizeopt').find('.active').children('a').text();
				var color = $('.coloropt').find('.active').children('a').text();
				if(size!='' && color!='') {
					var html = '';
					html += '';
					html += '<div class="option_result opt_'+size+'_'+color+'">';
					html += '	<div class="result_text">';
					html += '		<p id="prdName">러그 '+size+'/'+color+'</p>';
					html += '		<ul class="result_num">';
					html += '			<li class="num_min">';
					html += '				<a href="javascript:void(0);" onclick="removeCnt(this);"><span class="xi-minus"></span></a>';
					html += '			</li>';
					html += '			<li class="num_tit">';
					html += '				<span>1</span>';
					html += '			</li>';
					html += '			<li class="num_plu">';
					html += '				<a href="javascript:void(0);" onclick="addCnt(this);"><span class="xi-plus"></span></a>';
					html += '			</li>';
					html += '		</ul>';
					html += '	</div>';
					html += '	<button type="button" class="close_btn" onclick="closeOption(this);"><span class="xi-close"></span></button>';
					html += '</div>';
					$(".option_area").append(html);
					$("#duck").hide();
					$(".option_start").show();

					// 금액 더하기
					totalprice = totalprice + 1000;
					pricecnt = pricecnt+1;
					$(".total_rePrice").text(totalprice+'원');
					$(".total_num").text('('+pricecnt+')개');
				}else {
					alert('옵션을 선택해 주세요.');
				}
			});

			$("#customAr").on('click', function(){
				if (!Mobile()){// 모바일일 경우
					$(".qr_div").show();
				}
			});

			function Mobile(){
				return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
			}
				
			var tt = $("#duck")[0].shadowRoot;
			tt.querySelector('.container').querySelector('div .ar-button').style.display='block';
			// tt.querySelector('#default-ar-button').style.bottom='80px';
			// tt.querySelector('#default-ar-button').style.right='1%';

			// 프로그레스바 이벤트 바인딩
			document.querySelector('#duck').addEventListener('progress', onProgress);

		});

		// 옵션 닫기
		function closeOption(el) {
			var delCnt = $(el).parent().find('.num_tit span').text();

			totalprice = totalprice-(1000*delCnt);
			pricecnt = pricecnt-(1*delCnt);
			$(".total_rePrice").text(totalprice+'원');
			$(".total_num").text('('+pricecnt+')개');

			$(el).parent().remove();
		}

		function removeCnt(el) {
			var removeCnt=$(el).parents('.result_num').find('.num_tit span').text();
			if(removeCnt==1) {
				$(el).parents('.option_result').remove();
			} else {
				removeCnt = Number(removeCnt)-1;
				$(el).parents('.result_num').find('.num_tit span').text(removeCnt);
			}

			totalprice = totalprice - 1000;
			pricecnt = pricecnt-1;
			$(".total_rePrice").text(totalprice+'원');
			$(".total_num").text('('+pricecnt+')개');

		}
		function addCnt(el) {
			var addCnt=$(el).parents('.result_num').find('.num_tit span').text();
			addCnt = Number(addCnt)+1;
			$(el).parents('.result_num').find('.num_tit span').text(addCnt);

			totalprice = totalprice + 1000;
			pricecnt = pricecnt+1;
			$(".total_rePrice").text(totalprice+'원');
			$(".total_num").text('('+pricecnt+')개');
		}

		// 프로그레스바 호출 함수
		const onProgress = (event) => {
			$(".progress-bar").removeClass("hide");
			const progressBar = event.target.querySelector('.progress-bar');
			const updatingBar = event.target.querySelector('.update-bar');
			updatingBar.style.width = `${event.detail.totalProgress*100}%`;
			if (event.detail.totalProgress == 1) {
				progressBar.classList.add('hide');
			}
		};
	</script>
</body>
</html>
